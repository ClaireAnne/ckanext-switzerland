{% extends "package/base.html" %}

{% set res = c.resource %}

{% block head_extras -%}
  {{ super() }}
  {% set description = h.markdown_extract(res.description, extract_length=200) if res.description else h.markdown_extract(c.package.notes, extract_length=200) %}
  <meta property="og:title" content="{{ h.dataset_display_name(c.package) }} - {{ h.resource_display_name(res) }} - {{ g.site_title }}">
  <meta property="og:description" content="{{ description|forceescape }}">
{% endblock -%}

{% block subtitle %}{{ h.dataset_display_name(c.package) }} - {{ h.resource_display_name(res) }}{% endblock %}

{% block breadcrumb_content_selected %}{% endblock %}

{% block breadcrumb_content %}
  {{ super() }}
  <li class="active"><a href="">{{ h.resource_display_name(res)|truncate(30) }}</a></li>
{% endblock %}

{% block page_title %}
  <h1>{{ h.resource_display_name(res) }}</h1>
{% endblock %}

{% block primary_content %}
  <section class="container description">
    <div class="row">
      <div class="col-md-2">
        <dl>
          <dt>{{ _('Last updated') }}</dt>
          {# TODO use issued or modified date #}
          <dd>{{ h.render_datetime(res.created, with_hours=False) }}</dd>
        </dl>
      </div>
      <div class="col-md-2">
        <dl>
          <dt>{{ _('Terms of use') }}</dt>
          <dd class="terms">
            {% if res.rights == 'NonCommercialAllowed-CommercialAllowed-ReferenceNotRequired' %}
              <img src="/content/themes/wp-ogdch-theme/assets/images/terms/terms_open.svg" />
            {% elif res.rights == 'NonCommercialAllowed-CommercialAllowed-ReferenceRequired' %}
              <img src="/content/themes/wp-ogdch-theme/assets/images/terms/terms_ref.svg" />
              {% elif res.rights == 'NonCommercialAllowed-CommercialWithPermission-ReferenceNotRequired' %}
              <img src="/content/themes/wp-ogdch-theme/assets/images/terms/terms_ask.svg" />
              {% elif res.rights == 'NonCommercialAllowed-CommercialWithPermission-ReferenceRequired' %}
              <img src="/content/themes/wp-ogdch-theme/assets/images/terms/terms_ref-ask.svg" />
            {% else %}
              -
            {% endif %}
          </dd>
        </dl>
      </div>
      <div class="col-md-4">
        <dl>
          <dt>{{ _('Organization') }}</dt>
          <dd>
            {% if pkg.owner_org %}
              {% set organization = h.get_localized_org(pkg.owner_org) %}
              {% set url = h.url_for(controller='organization', action='read', id=organization.name) %}
              <a href="{{ url }}">{{ organization.title or organization.name }}</a>
            {% else %}
              {{ _('No organisation available') }}
            {% endif %}
          </dd>
        </dl>
      </div>
      <div class="col-md-4">
        <dl>
          <dt>{{ _('Download') }}</dt>
          <dd>
            {% if pkg.owner_org %}
            {% set organization = h.get_localized_org(pkg.owner_org) %}
            {% set url = h.url_for(controller='organization', action='read', id=organization.name) %}
            <a href="{{ url }}">{{ organization.title or organization.name }}</a>
            {% else %}
            {{ _('No organisation available') }}
            {% endif %}
          </dd>
        </dl>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12">
        <h2>{{ _('Description') }}</h2>
        {% if res.description %}
          <p>{{ res.description }}</p>
        {% endif %}
        {% if not res.description and c.package.description %}
          <p>{{ c.package.get('description') }}</p>
        {% endif %}
      </div>
    </div>
  </section>

  <section class="container">
    <div class="row">
      <div class="col-xs-12">
        <h2>{{ _('Description') }}</h2>


        {% block resource_additional_information %}
          {% if res %}
            <section class="module">
              {% block resource_additional_information_inner %}
              <div class="module-content">
                <h2>{{ _('Additional Information') }}</h2>
                <table class="table table-striped table-bordered table-condensed" data-module="table-toggle-more">
                  <thead>
                    <tr>
                      <th scope="col">{{ _('Field') }}</th>
                      <th scope="col">{{ _('Value') }}</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <th scope="row">{{ _('Last updated') }}</th>
                      <td>{{ h.render_datetime(res.last_modified) or h.render_datetime(res.revision_timestamp) or h.render_datetime(res.created) or _('unknown') }}</td>
                    </tr>
                    <tr>
                      <th scope="row">{{ _('Created') }}</th>
                      <td>{{ h.render_datetime(res.created) or _('unknown') }}</td>
                    </tr>
                    <tr>
                      <th scope="row">{{ _('Format') }}</th>
                      <td>{{ res.mimetype_inner or res.mimetype or res.format or _('unknown') }}</td>
                    </tr>
                    <tr>
                      <th scope="row">{{ _('License') }}</th>
                      <td>{% snippet "snippets/license.html", pkg_dict=pkg, text_only=True %}</td>
                    </tr>
                    {% for key, value in h.format_resource_items(res.items()) %}
                      <tr class="toggle-more"><th scope="row">{{ key }}</th><td>{{ value }}</td></tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              {% endblock %}
            </section>
          {% endif %}
        {% endblock %}
      </div>
    </div>
  </section>
{% endblock %}
